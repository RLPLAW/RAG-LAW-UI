<Window x:Class="RAG_UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RAG_UI"
        mc:Ignorable="d"
        Title="RAG Assistant" Height="800" Width="1200"
        Background="#1E1E1E"
        MinWidth="500" MinHeight="200" WindowStartupLocation="CenterScreen"
>

    <Window.Resources>
        <Style x:Key="AvatarStyle" TargetType="Border">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Background" Value="#4A9EFF"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
        </Style>

        <Style x:Key="UserAvatarStyle" TargetType="Border" BasedOn="{StaticResource AvatarStyle}">
            <Setter Property="Background" Value="#10A37F"/>
            <Setter Property="Margin" Value="10,0,0,0"/>
        </Style>

        <Style x:Key="MessageBubbleBase" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="0,8,50,8"/>
            <Setter Property="MaxWidth" Value="600"/>
        </Style>

        <Style x:Key="AssistantMessageBubble" TargetType="Border" BasedOn="{StaticResource MessageBubbleBase}">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
        </Style>

        <Style x:Key="UserMessageBubble" TargetType="Border" BasedOn="{StaticResource MessageBubbleBase}">
            <Setter Property="Background" Value="#10A37F"/>
            <Setter Property="Margin" Value="50,8,0,8"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
        </Style>

        <Style x:Key="MessageTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="LineHeight" Value="20"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
        </Style>
        
        <Border x:Key="TypingIndicatorBubble"
                    Style="{StaticResource AssistantMessageBubble}"
                    x:Shared="False">
            <TextBlock Style="{StaticResource MessageTextStyle}"
               Text="Wait a minute..." x:Name="tbTyping"/>
        </Border>

        <ControlTemplate x:Key="HoverButtonTemplate" TargetType="Button">
            <Border Background="{TemplateBinding Background}" 
                    CornerRadius="{TemplateBinding Tag}"
                    Padding="{TemplateBinding Padding}">
                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                VerticalAlignment="Center"/>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2A2A2A"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <Style x:Key="SidebarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#B0B0B0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Template" Value="{StaticResource HoverButtonTemplate}"/>
            <Setter Property="Tag" Value="6"/>
        </Style>

        <Style x:Key="ConversationItemStyle" TargetType="Border">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <ControlTemplate x:Key="ActionButtonTemplate" TargetType="Button">
            <Border Background="{TemplateBinding Background}" 
                    CornerRadius="4"
                    Padding="4">
                <ContentPresenter HorizontalAlignment="Center" 
                                VerticalAlignment="Center"/>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3A3A3A"/>
                    <Setter Property="Foreground" Value="#FFFFFF"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#888888"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="Template" Value="{StaticResource ActionButtonTemplate}"/>
        </Style>

        <Style x:Key="InputTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#404040"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="Padding" Value="16,12"/>
        </Style>

        <ControlTemplate x:Key="SendButtonTemplate" TargetType="Button">
            <Border Background="{TemplateBinding Background}" 
                    CornerRadius="24"
                    Width="48" 
                    Height="48">
                <Path Fill="White" 
                      HorizontalAlignment="Center" 
                      VerticalAlignment="Center"
                      Data="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#0D8A6B"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#404040"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <ControlTemplate x:Key="NewChatButtonTemplate" TargetType="Button">
            <Border Background="{TemplateBinding Background}" 
                    CornerRadius="6"
                    Padding="16,8">
                <ContentPresenter HorizontalAlignment="Center" 
                                VerticalAlignment="Center"/>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#0D8A6B"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="#171717" BorderBrush="#2D2D2D" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Margin="16,20">
                    <Button Content="+ New Chat" 
                            Background="#10A37F" 
                            Foreground="White" 
                            BorderThickness="0"
                            Height="40"
                            FontWeight="Medium"
                            FontSize="14"
                            Margin="0,0,0,16"
                            Template="{StaticResource NewChatButtonTemplate}"/>
                </StackPanel>

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="8,0">
                    <StackPanel>
                        <TextBlock Text="Recent Conversations" 
                                   Foreground="#B0B0B0" 
                                   FontSize="12" 
                                   FontWeight="Medium"
                                   Margin="12,8,12,12"/>

                        <Border Style="{StaticResource ConversationItemStyle}" Background="#2A2A2A">
                            <StackPanel>
                                <TextBlock Text="How to implement RAG?" 
                                           Foreground="White" 
                                           FontSize="13"
                                           TextTrimming="CharacterEllipsis"/>
                                <TextBlock Text="2 hours ago" 
                                           Foreground="#888888" 
                                           FontSize="11"
                                           Margin="0,2,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <Border Grid.Row="2" BorderBrush="#2D2D2D" BorderThickness="0,1,0,0" Padding="16">
                    <StackPanel>
                        <Button Style="{StaticResource SidebarButtonStyle}" Margin="0,8" Height="56">
                            <StackPanel Orientation="Horizontal">
                                <Border Style="{StaticResource UserAvatarStyle}" Margin="0,0,12,0">
                                    <TextBlock x:Name="txtbAvatar" Text="U" 
                                               Foreground="White" 
                                               FontWeight="Bold" 
                                               HorizontalAlignment="Center" 
                                               VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock x:Name="txtUsername" Text="User Account" Foreground="White" FontSize="13" Height="19"/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="btnSettings" Style="{StaticResource SidebarButtonStyle}" Height="46" Click="btnSettings_Click">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="⚙" FontSize="16" Margin="1,0,3,6"/>
                                <TextBlock Text="Settings"/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="btnHelps" Style="{StaticResource SidebarButtonStyle}" Click="btnHelps_Click">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="?" FontSize="16" Margin="7,0,10,0"/>
                                <TextBlock Text="Help &amp; Support"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="60"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" Background="#1E1E1E" BorderBrush="#2D2D2D" BorderThickness="0,0,0,1">
                <Grid Margin="24,0">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Border Style="{StaticResource AvatarStyle}">
                            <TextBlock Text="AI" 
                                       Foreground="White" 
                                       FontWeight="Bold" 
                                       HorizontalAlignment="Center" 
                                       VerticalAlignment="Center"
                                       FontSize="12"/>
                        </Border>
                        <StackPanel>
                            <TextBlock Text="Angler Assistant" 
                                       Foreground="White" 
                                       FontSize="16" 
                                       FontWeight="Medium"/>
                            <TextBlock Text="Online" 
                                       Foreground="#10A37F" 
                                       FontSize="12"/>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <TextBlock Text="Model: GPT-OSS" Foreground="#B0B0B0" FontSize="12" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <ScrollViewer Grid.Row="1" 
                          x:Name="svChat"
                          VerticalScrollBarVisibility="Auto" 
                          HorizontalScrollBarVisibility="Disabled"
                          Background="#1E1E1E"
                          Padding="24,16">
                <StackPanel x:Name="spMessages">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,16">
                        <Border Style="{StaticResource AvatarStyle}">
                            <TextBlock Text="AI" 
                                       Foreground="White" 
                                       FontWeight="Bold" 
                                       HorizontalAlignment="Center" 
                                       VerticalAlignment="Center"
                                       FontSize="12"/>
                        </Border>
                        <StackPanel>
                            <Border Style="{StaticResource AssistantMessageBubble}">
                                <TextBlock Style="{StaticResource MessageTextStyle}"
                                           Text="Hello! I'm your RAG Assistant. I can help you with document analysis, question answering, and information retrieval. How can I assist you today?"/>
                            </Border>

                            <StackPanel Orientation="Horizontal" 
                                       HorizontalAlignment="Left"
                                       Margin="16,8,0,0" Height="27">
                                <Button Style="{StaticResource ActionButtonStyle}" ToolTip="Copy">
                                    <Path Fill="#888888" Data="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                                </Button>
                                <Button Style="{StaticResource ActionButtonStyle}" ToolTip="Read aloud">
                                    <Path Fill="#888888" Data="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                                </Button>
                                <Button Style="{StaticResource ActionButtonStyle}" ToolTip="Like">
                                    <Path Fill="#888888" Data="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-1.91l-.01-.01L23 10z"/>
                                </Button>
                                <Button Style="{StaticResource ActionButtonStyle}" ToolTip="Dislike">
                                    <Path Fill="#888888" Data="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v1.91l.01.01L1 14c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"/>
                                </Button>
                                <Button Style="{StaticResource ActionButtonStyle}" ToolTip="Regenerate">
                                    <Path Fill="#888888" Data="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16">
                        <StackPanel/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>

            <Border Grid.Row="2" 
                    Background="#1E1E1E" 
                    BorderBrush="#2D2D2D" 
                    BorderThickness="0,1,0,0" 
                    CornerRadius="13"
                    Padding="24,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="txtbMessageInput"
                             Grid.Column="0"
                             Style="{StaticResource InputTextBoxStyle}"
                             TextWrapping="Wrap"
                             MaxHeight="120"
                             Foreground="#888888"
                             Height="48"
                             VerticalAlignment="Center" GotFocus="txtbMessageInput_GotFocus" LostFocus="txtbMessageInput_LostFocus"
                             KeyDown="txtbMessageInput_KeyDown"/>

                    <Button Grid.Column="1" 
                            x:Name="btnSend"
                            Width="48"
                            Margin="12,0,0,0"
                            Background="#10A37F"
                            BorderThickness="0"
                            Click="btnSend_Click"
                            Template="{StaticResource SendButtonTemplate}" Cursor="Hand"/>
                </Grid>
            </Border>

        </Grid>
    </Grid>
</Window>